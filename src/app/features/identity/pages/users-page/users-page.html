<section class="space-y-4">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <div>
      <h1 class="text-lg font-semibold text-gray-900">Users</h1>
      <p class="text-sm text-gray-500">Manage user accounts and access.</p>
    </div>
    <cxs-button size="sm" (click)="onOpenAddUser()">Add user</cxs-button>
  </div>

  @if (error()) {
    <div
      class="rounded-md border border-red-200 bg-red-50 px-4 py-2 text-sm text-red-700"
    >
      {{ error() }}
    </div>
  }

  <cxs-card>
    <cxs-data-table
      caption="All users"
      [allowOverflow]="true"
      [bordered]="true"
      [columnBorders]="true"
      [columns]="columns"
      [data]="rows()"
      [loading]="loading()"
      [manualFilter]="true"
      [manualPagination]="true"
      [manualSort]="true"
      [pageIndex]="pageIndex()"
      [pageSize]="pageSize()"
      [showFilters]="true"
      [showGlobalSearch]="true"
      [sortDirection]="sortDirection()"
      [sortKey]="sortKey()"
      [striped]="true"
      [total]="totalCount()"
      (filterChange)="onFilterChange($event)"
      (pageChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)"
      (sortChange)="onSortChange($event)"
    >
      <ng-template cxsDataTableCell="actions" let-row>
        <div class="flex items-center justify-end">
          <cxs-action-menu
            [items]="actionMenuItems"
            [floating]="true"
            (itemSelected)="onActionSelected($event, $any(row).id)"
          />
        </div>
      </ng-template>
    </cxs-data-table>

  </cxs-card>

  <cxs-dialog
    description="Create a new user account."
    title="Add user"
    [open]="addUserOpen()"
    (openChange)="onCloseAddUser()"
  >
    <form class="grid gap-4" [formGroup]="addUserForm" (ngSubmit)="onSubmitAddUser()">

      <cxs-input formControlName="username" label="Username" placeholder="Username" />


      <cxs-input formControlName="email" label="Email" placeholder="user@example.com" type="email">
        @if (addUserForm.get('email')?.touched && addUserForm.get('email')?.invalid) {
          <span cxsInputError>Enter a valid email address.</span>
        }
      </cxs-input>
      <cxs-input formControlName="phoneNumber" label="Phone" placeholder="+1 555 0100" type="tel" />
      <cxs-input formControlName="password" label="Password" placeholder="Password" type="password" />
    </form>

    @if (addUserError()) {
      <div
        class="mt-3 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700"
      >
        {{ addUserError() }}
      </div>
    }

    <div cxsDialogActions>
      <cxs-button variant="secondary" (click)="onCloseAddUser()">Cancel</cxs-button>
      <cxs-button
        type="submit"
        [disabled]="addUserLoading()"
        [loading]="addUserLoading()"
        (click)="onSubmitAddUser()"
      >
        Create user
      </cxs-button>
    </div>
  </cxs-dialog>

  <cxs-toast
    [duration]="3500"
    [message]="toastMessage()"
    [open]="toastOpen()"
    [title]="toastTitle()"
    [variant]="toastVariant()"
    (openChange)="onToastOpenChange($event)"
  />
</section>
